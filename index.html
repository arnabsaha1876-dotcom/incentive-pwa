<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Incentive Calculator</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0f4c81">

  <!-- iOS install -->
  <link rel="apple-touch-icon" href="icons/icon-192.png">

  <style>
    :root{
      --brand:#0f4c81;
      --ok:#2e7d32;
      --warn:#ef6c00;
      --danger:#c62828;
      --bg:#f6f8fb;
      --txt:#1f2937;
      --card:#ffffff;
      --bar-bg:#e6eaf0;
      --bar-good:#2e7d32;
      --bar-amber:#ef6c00;
      --bar-red:#c62828;
      --grid:#d7dce3;
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:960px;margin:0 auto;padding:16px 12px 80px}
    header{display:flex;align-items:center;gap:12px;margin:4px 0 12px}
    header h1{font-size:20px;margin:0}
    .card{background:var(--card);border:1px solid #e7ebf0;border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.04);padding:14px;margin:10px 0}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media (max-width:720px){.row{grid-template-columns:1fr}}
    label{font-size:13px;color:#475569;margin-bottom:6px;display:block}
    input[type=number]{width:100%;padding:12px 14px;border:1px solid #cbd5e1;border-radius:10px;font-size:16px}
    .btn{width:100%;padding:12px 16px;background:var(--brand);color:#fff;border:0;border-radius:10px;font-size:16px}
    .muted{color:#64748b;font-size:12px}

    /* Progress bar with zones */
    .bar{position:relative;height:18px;border-radius:10px;background:var(--bar-bg);overflow:hidden}
    .bar .fill{position:absolute;left:0;top:0;height:100%;background:linear-gradient(90deg,#d32f2f,#f57c00,#fbc02d,#7cb342,#388e3c);transition:width .4s ease}
    .bar .tick{position:absolute;top:0;height:100%;width:2px;background:#fff5;border-left:1px solid #9aa5b1}
    .bar-labels{display:flex;justify-content:space-between;font-size:11px;color:#64748b;margin-top:6px}

    .callout{border-left:4px solid var(--warn);background:#fff7ed;color:#7c3f10;padding:8px 10px;border-radius:8px;margin-top:12px;font-size:14px}

    /* Speedometer */
    .gauge-wrap{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media (max-width:900px){.gauge-wrap{grid-template-columns:1fr}}
    .gauge{position:relative;background:var(--card);border:1px solid #e7ebf0;border-radius:12px;padding:10px;display:flex;flex-direction:column;align-items:center}
    svg{max-width:520px;width:100%;height:auto}
    .pointer{transform-origin:50% 100%;transition:transform .5s ease}
    .legend{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
    .chip{display:inline-flex;align-items:center;gap:6px;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px;font-size:12px;background:#fff;cursor:pointer}
    .chip .dot{width:10px;height:10px;border-radius:50%}

    /* Zone details */
    .zone-details h3{margin:.2rem 0 .4rem}
    .zone-details p{margin:.2rem 0}

    /* Rewards overlay */
    .reward{
      position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.15);z-index:10;
    }
    .reward.show{display:grid}
    .reward .stage{position:relative;width:100%;height:100%}
    .confetti{position:absolute;top:-10px;width:10px;height:16px;opacity:.9;animation:fall linear forwards}
    @keyframes fall{
      to{transform:translateY(110vh) rotate(720deg);opacity:1}
    }
    .reward .big-emoji{
      position:absolute;inset:auto 0 18% 0;text-align:center;font-size:56px;filter:drop-shadow(0 3px 8px rgba(0,0,0,.25))
    }

    /* Output */
    .stat{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px dashed #e5e7eb}
    .stat:last-child{border-bottom:0}
    .stat b{font-size:16px}
    .green{color:#1b5e20}
    .red{color:#b91c1c}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="icons/icon-192.png" alt="" width="28" height="28" style="border-radius:6px"/>
      <h1>Incentive Calculator</h1>
    </header>

    <!-- Inputs -->
    <div class="card">
      <div class="row">
        <div>
          <label>üéØ Monthly Target (‚Çπ)</label>
          <input id="target" type="number" inputmode="numeric" placeholder="e.g., 100000" />
        </div>
        <div>
          <label>‚úÖ Achieved So Far (‚Çπ)</label>
          <input id="achieved" type="number" inputmode="numeric" placeholder="e.g., 97000" />
        </div>
      </div>
      <div style="margin-top:10px">
        <button class="btn" id="btnCalc">Show My Incentives</button>
      </div>
      <p class="muted">Tip: Save to your phone home screen for 1‚Äëtap access (Menu ‚Üí Add to Home Screen).</p>
    </div>

    <!-- Progress -->
    <div class="card">
      <h3 style="margin:6px 0 10px">Progress to Incentive</h3>
      <div class="bar" id="bar">
        <div class="fill" id="barFill" style="width:0%"></div>
        <!-- Major ticks at 95,100,115,125,150,200,300 -->
        <div class="tick" style="left:31.7%"></div><!-- 95/300 -->
        <div class="tick" style="left:33.3%"></div><!-- 100/300 -->
        <div class="tick" style="left:38.3%"></div><!-- 115/300 -->
        <div class="tick" style="left:41.7%"></div><!-- 125/300 -->
        <div class="tick" style="left:50%"></div><!-- 150/300 -->
        <div class="tick" style="left:66.7%"></div><!-- 200/300 -->
        <div class="tick" style="left:100%"></div><!-- 300/300 -->
      </div>
      <div class="bar-labels">
        <span>0%</span><span>95%</span><span>100%</span><span>115%</span><span>125%</span><span>150%</span><span>200%</span><span>300%+</span>
      </div>
      <div id="nearMiss" class="callout" style="display:none">‚ö†Ô∏è <b>Don‚Äôt leave money on the table:</b> You‚Äôre <span id="missAmt"></span> away from 95%.</div>
    </div>

    <!-- Results -->
    <div class="card" id="results" style="display:none">
      <h3 style="margin:6px 0 12px">Your Incentive Snapshot</h3>

      <div class="stat">
        <span>Achievement %</span><b id="outPct">‚Äî</b>
      </div>
      <div class="stat">
        <span>Current Incentive</span><b id="outIncentive">‚Äî</b>
      </div>
      <div class="stat">
        <span>Next Slab @</span><b id="outNextSlab">‚Äî</b>
      </div>
      <div class="stat">
        <span>Do more to reach next slab</span><b id="outGap">‚Äî</b>
      </div>
      <div class="stat">
        <span>Incentive at next slab</span><b id="outNextInc">‚Äî</b>
      </div>

      <p class="muted" id="outMsg" style="margin-top:8px"></p>
    </div>

    <!-- Speedometer & Zone details -->
    <div class="gauge-wrap">
      <div class="gauge">
        <h3 style="margin:6px 0 6px">Incentive Speedometer</h3>
        <!-- Semicircle 0‚Äì300% split into 8 zones (red ‚Üí green) -->
        <svg viewBox="0 0 200 120" id="gaugeSvg">
          <!-- Zones (clickable arcs) -->
          <g id="zones"></g>
          <!-- Pointer -->
          <g transform="translate(100,100)">
            <polygon id="pointer" class="pointer" points="0,-70 3,0 -3,0" fill="#111"/>
            <circle cx="0" cy="0" r="5" fill="#111"/>
          </g>
        </svg>
        <div class="legend" id="legend"></div>
      </div>

      <div class="card zone-details" id="zoneDetails">
        <h3>Zone details</h3>
        <p class="muted">Tap a zone above to see min/max achievement in ‚Çπ, rate, your gap, and sample incentives.</p>
        <div id="zoneBody"></div>
      </div>
    </div>
  </div>

  <!-- Rewards overlay -->
  <div class="reward" id="reward">
    <div class="stage" id="stage"></div>
    <div class="big-emoji" id="rewardEmoji">üéâ</div>
  </div>

  <script>
    /*********************
     * UTILITIES
     *********************/
    const INR = new Intl.NumberFormat('en-IN',{style:'currency',currency:'INR',maximumFractionDigits:0});
    const PCT = (v)=> (Math.round(v*10)/10)+'%';
    const clamp=(v,min,max)=>Math.max(min,Math.min(max,v));

    // Slab definition (from your table)
    // Important: at exactly 95% ‚Üí 0.5%; 95‚Äì100% (exclusive of 95) ‚Üí 1.0%
    const SLABS = [
      { name:'Zone 1',  min:0,   max:95,   rate:0.00, color:'#d32f2f', label:'0‚Äì95% (No incentive)' },
      { name:'Zone 2',  min:95,  max:100,  rate:0.01, color:'#ef6c00', label:'95‚Äì100% (0.5% at exactly 95%)' },
      { name:'Zone 3',  min:100, max:115,  rate:0.025,color:'#f9a825', label:'100‚Äì115%' },
      { name:'Zone 4',  min:115, max:125,  rate:0.035,color:'#c0ca33', label:'115‚Äì125%' },
      { name:'Zone 5',  min:125, max:150,  rate:0.04, color:'#8bc34a', label:'125‚Äì150%' },
      { name:'Zone 6',  min:150, max:200,  rate:0.05, color:'#66bb6a', label:'150‚Äì200%' },
      { name:'Zone 7',  min:200, max:300,  rate:0.06, color:'#43a047', label:'200‚Äì300%' },
      { name:'Zone 8',  min:300, max:9999, rate:0.08, color:'#2e7d32', label:'300%+' }
    ];

    function rateFor(pct, achieved, target){
      const eps=0.0001;
      if (pct < 95) return 0;
      const exactly95 = Math.abs(achieved - 0.95*target) < 0.5; // ‚Çπ rounding tolerance
      if (exactly95) return 0.005; // 0.5%
      if (pct >= 95 && pct < 100) return 0.01;
      if (pct >= 100 && pct < 115) return 0.025;
      if (pct >= 115 && pct < 125) return 0.035;
      if (pct >= 125 && pct < 150) return 0.04;
      if (pct >= 150 && pct < 200) return 0.05;
      if (pct >= 200 && pct < 300) return 0.06;
      if (pct >= 300) return 0.08;
      return 0;
    }
    function nextThresholdPct(pct, exactly95){
      if (pct < 95) return 95;
      if (exactly95) return 100;
      if (pct < 100) return 100;
      if (pct < 115) return 115;
      if (pct < 125) return 125;
      if (pct < 150) return 150;
      if (pct < 200) return 200;
      if (pct < 300) return 300;
      return null; // already at top slab
    }

    /*********************
     * CORE CALC
     *********************/
    const el = (id)=>document.getElementById(id);

    function calculate(){
      const target = Number(el('target').value||0);
      const achieved = Number(el('achieved').value||0);
      if (!target || target<=0){
        alert('Please enter a valid Monthly Target (‚Çπ).');
        return;
      }

      const pct = (achieved/target)*100;
      const exactly95 = Math.abs(achieved - 0.95*target) < 0.5;
      const rate = rateFor(pct, achieved, target);
      const incentiveNow = Math.floor(achieved * rate);

      // Next slab
      const nextPct = nextThresholdPct(pct, exactly95);
      let gap=0, atNextIncentive=0;
      if (nextPct!==null){
        const nextAbs = Math.ceil((nextPct/100)*target);
        gap = Math.max(0, nextAbs - achieved);
        const rateNext = rateFor(nextPct, nextAbs, target);
        atNextIncentive = Math.floor(nextAbs * rateNext);
      }

      // Fill outputs
      el('results').style.display='block';
      el('outPct').innerText = PCT(pct);
      el('outIncentive').innerText = INR.format(incentiveNow);
      el('outNextSlab').innerText = nextPct===null ? 'Top slab (300%+)' : `${nextPct}% (${INR.format((nextPct/100)*target)})`;
      el('outGap').innerText = nextPct===null ? '‚Äî' : INR.format(gap);
      el('outNextInc').innerText = nextPct===null ? INR.format(incentiveNow) : INR.format(atNextIncentive);

      if (pct>=93 && pct<95){
        el('nearMiss').style.display='block';
        el('missAmt').innerText = INR.format(Math.ceil(0.95*target - achieved));
      }else{
        el('nearMiss').style.display='none';
      }

      // Progress bar: scale 0‚Äì300%
      const pctOfScale = clamp((pct/300)*100, 0, 100);
      el('barFill').style.width = pctOfScale + '%';

      // Gauge pointer (0% ‚Üí -90deg, 300% ‚Üí +90deg)
      const angle = clamp((pct/300)*180 - 90, -90, 90);
      el('pointer').style.transform = `rotate(${angle}deg)`;

      // Reward trigger on new slab reached
      triggerRewardIfSlabAdvanced(pct, exactly95);
    }

    /*********************
     * GAUGE (zones + click ‚Üí details)
     *********************/
    const zonesG = el('zones');
    const legend = el('legend');
    const zoneBody = el('zoneBody');

    function deg2rad(d){return (Math.PI/180)*d}
    function polarToXY(cx,cy,r,ang){return [cx + r*Math.cos(deg2rad(ang)), cy + r*Math.sin(deg2rad(ang))]}

    function buildGauge(){
      zonesG.innerHTML='';
      legend.innerHTML='';
      const centerX=100, centerY=100, radius=90;
      // Map % to degrees: 0%‚Üí-90¬∞, 300%‚Üí+90¬∞
      function pctToDeg(p){ return -90 + (p/300)*180 }
      SLABS.forEach((z,idx)=>{
        const startDeg = pctToDeg(z.min);
        const endDeg   = pctToDeg(Math.min(z.max,300));
        const [sx,sy]  = polarToXY(centerX,centerY,radius,startDeg);
        const [ex,ey]  = polarToXY(centerX,centerY,radius,endDeg);
        const largeArc = endDeg - startDeg > 180 ? 1 : 0;
        const path = document.createElementNS('http://www.w3.org/2000/svg','path');
        path.setAttribute('d', `M ${sx} ${sy} A ${radius} ${radius} 0 ${largeArc} 1 ${ex} ${ey}`);
        path.setAttribute('stroke', z.color);
        path.setAttribute('stroke-width','14');
        path.setAttribute('fill','none');
        path.style.cursor='pointer';
        path.addEventListener('click', ()=> showZoneDetails(idx));
        zonesG.appendChild(path);

        const c = document.createElement('div');
        c.className='chip';
        c.innerHTML = `<span class="dot" style="background:${z.color}"></span>${z.name}`;
        c.onclick = ()=> showZoneDetails(idx);
        legend.appendChild(c);
      });
    }

    function showZoneDetails(i){
      const t = Number(el('target').value||0);
      const a = Number(el('achieved').value||0);
      const z = SLABS[i];
      if (!t){ zoneBody.innerHTML = '<p class="muted">Enter Target and Achieved to compute absolute amounts.</p>'; return; }
      const minAbs = Math.ceil((z.min/100)*t);
      const maxAbs = (z.max>=300? null : Math.floor((z.max/100)*t));
      const gap = Math.max(0, minAbs - a);
      const rateText = (z.min===95 && z.max===100) ? '0.5% at exactly 95%; otherwise 1.0%' : (z.rate*100).toFixed(1)+'%';

      const incAtMin = z.min===0 ? 0 : Math.floor(minAbs * (z.min===95 && z.max===100 ? 0.01 : z.rate));
      const incAt95 = Math.floor(0.95*t*0.005);

      let html = `<p><b>${z.name}</b> ‚Äî ${z.label}</p>`;
      html += `<p>Achievement range: <b>${z.min}%</b> to <b>${z.max>=300?'300%+':z.max+'%'}</b></p>`;
      html += `<p>Absolute range: <b>${INR.format(minAbs)}</b> to <b>${maxAbs?INR.format(maxAbs):'‚àû'}</b></p>`;
      if (z.min===95 && z.max===100){
        html += `<p>Rate: <b>${rateText}</b> (Example at 95%: ${INR.format(incAt95)})</p>`;
      }else{
        html += `<p>Rate: <b>${rateText}</b> (Incentive at zone minimum: ${INR.format(incAtMin)})</p>`;
      }
      html += `<p>Gap to enter this zone: <b class="${gap>0?'red':'green'}">${gap>0?INR.format(gap):'You are in / above this zone'}</b></p>`;
      zoneBody.innerHTML = html;
    }

    /*********************
     * REWARDS (different visuals per slab)
     *********************/
    let lastSlabIdx = -1;
    function slabIndexForPct(pct, exactly95){
      if (pct < 95) return 0;                 // Zone 1
      if (exactly95) return 1;                // Special case: 95% (still Zone 2)
      if (pct < 100) return 1;                // Zone 2
      if (pct < 115) return 2;
      if (pct < 125) return 3;
      if (pct < 150) return 4;
      if (pct < 200) return 5;
      if (pct < 300) return 6;
      return 7;
    }
    const REWARD_EMOJIS = ['üôå','üéâ','üëè','ü•â','ü•à','ü•á','üèÜ','üëë'];

    function triggerRewardIfSlabAdvanced(pct, exactly95){
      const idx = slabIndexForPct(pct, exactly95);
      if (idx>lastSlabIdx){
        lastSlabIdx = idx;
        runReward(idx);
      }
    }

    function runReward(idx){
      const overlay = el('reward');
      const stage = el('stage');
      const emoji = el('rewardEmoji');
      stage.innerHTML='';
      emoji.textContent = REWARD_EMOJIS[idx] || 'üéâ';
      overlay.classList.add('show');

      // Spawn confetti (more for higher slabs)
      const colors = ['#ff5252','#ffd740','#69f0ae','#40c4ff','#b388ff','#ff8a80'];
      const count = 60 + idx*20;
      for (let i=0;i<count;i++){
        const d = document.createElement('div');
        d.className='confetti';
        d.style.left = Math.random()*100 + 'vw';
        d.style.background = colors[i % colors.length];
        d.style.transform = `translateY(-10px) rotate(${Math.random()*360}deg)`;
        d.style.animationDuration = (2 + Math.random()*2) + 's';
        d.style.animationDelay = (Math.random()*0.6)+'s';
        stage.appendChild(d);
      }

      // Auto hide
      setTimeout(()=> overlay.classList.remove('show'), 2200);
    }

    /*********************
     * INIT
     *********************/
    buildGauge();
    document.getElementById('btnCalc').addEventListener('click', ()=>{ calculate(); showZoneDetails(0); });

    // PWA SW
    if ('serviceWorker' in navigator){
      navigator.serviceWorker.register('./service-worker.js');
    }
  </script>
</body>
</html>
``
